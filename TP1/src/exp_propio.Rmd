---
title: "exp_propio"
author: "Patricio Guledjian, Azul Noguera, Rocio Gonzalez"
date: "2023-08-17"
output: html_document
---

```{r}
source("exp_propio.R")
```

```{r}
library(rpart)

#Buscamos las variables mas importantes de el dataset Wine.
datos_wine <- read.csv("./data/winequality_modificados.csv")
data_df_wine <- datos_wine

tree_wine <- rpart(quality ~ ., data=data_df_wine, control=rpart.control(minsplit=2, minbucket=1, maxdepth=10, cp=0, xval=0))

variable_importance_wine <- tree_wine$variable.importance
tree_wine$variable.importance
mean(variable_importance_wine)
################################################################################

#Buscamos las variables mas importantes de el dataset Churn
datos_churn <- read.csv("./data/customer_churn.csv")
data_df_churn <- datos_churn

tree_churn <- rpart(churn ~ ., data=data_df_churn, control=rpart.control(minsplit=2, minbucket=1, maxdepth=10, cp=0, xval=0))

variable_importance_churn <- tree_churn$variable.importance
tree_churn$variable.importance
mean(variable_importance_churn)
################################################################################

#Buscamos las variables mas importantes de el dataset Heart
datos_heart <- read.csv("./data/heart.csv")
data_df_heart <- datos_heart

tree_heart <- rpart(HeartDisease ~ ., data=data_df_heart, control=rpart.control(minsplit=2, minbucket=1, maxdepth=10, cp=0, xval=0))

variable_importance_heart <- tree_heart$variable.importance
tree_heart$variable.importance
mean(variable_importance_heart)
################################################################################
```

```{r}
#Decidimos cuantas variables darle a cada nuevo dataset. Para eso, nos quedamos con todas las variables que superen en importancia al promedio.

num_top_variables_wine <- 6
num_top_variables_churn <- 6
num_top_variables_heart <- 6

top_variables_wine <- names(sort(variable_importance_wine, decreasing = TRUE)[1:num_top_variables_wine])
top_variables_churn <- names(sort(variable_importance_churn, decreasing = TRUE)[1:num_top_variables_churn])
top_variables_heart <- names(sort(variable_importance_heart, decreasing = TRUE)[1:num_top_variables_heart])

# Crear un nuevo conjunto de datos de entrenamiento con las variables más importantes y la variable objetivo
winequality_top <- datos[, c(top_variables_wine, "quality")]
customer_churn_top <- datos_churn[, c(top_variables_churn, "churn")]
heart_top <- datos_heart[, c(top_variables_heart, "HeartDisease")]
```

```{r}
#Cargamos los 3 nuevos datasets en la carpeta 'data'.

ruta_archivo_nuevo <- "./data/winequality_top.csv"
write.csv(winequality_top, file=ruta_archivo_nuevo, sep = ',', row.names=FALSE)

ruta_archivo_nuevo <- "./data/customer_churn_top.csv"
write.csv(customer_churn_top, file=ruta_archivo_nuevo, sep = ',', row.names=FALSE)

ruta_archivo_nuevo <- "./data/heart_top.csv"
write.csv(heart_top, file=ruta_archivo_nuevo, sep = ',', row.names=FALSE)
```

```{r}

library(magick)

# Ruta de la imagen JPG
ruta_imagen <- "./outputs/plots/exp_propio.jpg"

# Cargar y mostrar la imagen
imagen <- image_read(ruta_imagen)
# Redimensionar la imagen para ajustarla al tamaño de la consola
imagen_redimensionada <- image_scale(imagen, "475x500")

# Mostrar la imagen redimensionada en la consola
print(imagen_redimensionada)

```

Lo que propusimos en nuestro experimento fue seleccionar las variables mas importantes a la hora de crear el modelo, y de esa forma analizar como se compara su performance al modelo original. Llevamos a cabo la obtencion de las variables mas importantes con rpart, y luego tuvimos que elegir una estrategia para decidir que variables formaran parte del nuevo dataset. Para eso, calculamos la media entre todas las importancias de las variables del dataset original, y a partir de este valor nos quedamos con todas aquellas variables cuya importancia era mayor al promedio. Asi, cada uno de los datasets original termino siendo reducido a un total de 6 variables predictoras.

Hicimos este experimento para analizar si al tener mas variables predictoras, la performance siempre sera mayor, o si todo depende de la importancia de cada una de ellas y las particularidades de los datasets. Calculamos la performance de los 3 datasets originales, y de los 3 datasets con las 6 variables predictoras.

Comencemos con las observaciones:

- En primer lugar, podemos ver que las performances de los datasets originales vs datasets reducidos son en general muy parecidos, con una performance casi identica. Si decidimos ponernos mas especificos, a mas profundidad del arbol, los datasets originales tienden a tener apenas mas de performance que los 




























